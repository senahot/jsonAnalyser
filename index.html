<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Analyser - Query JSON Data</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>üîç JSON Analyser</h1>
                <p class="tagline">Query and analyze JSON data in your browser</p>
            </div>
            <div class="header-actions">
                <button id="savedQueriesBtn" class="btn btn-secondary" title="Saved Queries">
                    üíæ Saved
                </button>
                <button id="historyBtn" class="btn btn-secondary" title="Query History">
                    üìú History
                </button>
                <button id="helpBtn" class="btn btn-secondary" title="Help">
                    ‚ùì Help
                </button>
                <button id="themeToggle" class="btn btn-icon" title="Toggle Theme">
                    üåô
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel: JSON Input -->
            <section class="panel input-panel">
                <div class="panel-header">
                    <h2>JSON Input</h2>
                    <div class="panel-actions">
                        <button id="uploadBtn" class="btn btn-secondary" title="Upload JSON file">
                            üìÅ Upload File
                        </button>
                        <input type="file" id="fileInput" accept=".json" hidden>
                        <button id="formatBtn" class="btn btn-secondary" title="Format JSON">
                            ‚ú® Format
                        </button>
                        <button id="clearInputBtn" class="btn btn-secondary" title="Clear input">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>

                <div class="panel-body">
                    <div class="editor-container">
                        <textarea
                            id="jsonInput"
                            class="json-editor"
                            placeholder='Enter or paste your JSON here...

Example:
[
  {
    "name": "John Doe",
    "age": 30,
    "email": "john@example.com",
    "status": "active"
  },
  {
    "name": "Jane Smith",
    "age": 25,
    "email": "jane@example.com",
    "status": "inactive"
  }
]'
                            spellcheck="false"
                        ></textarea>
                    </div>

                    <div id="jsonError" class="error-message hidden"></div>

                    <div class="input-stats">
                        <span id="jsonStats" class="stats-text"></span>
                    </div>
                </div>
            </section>

            <!-- Right Panel: Query & Results -->
            <section class="panel output-panel">
                <!-- Query Section -->
                <div class="panel-header">
                    <h2>Query</h2>
                    <div class="panel-actions">
                        <!-- Mode Toggle -->
                        <div class="mode-toggle">
                            <button id="codeMode" class="mode-btn active" title="Code mode">
                                üíª Code
                            </button>
                            <button id="builderMode" class="mode-btn" title="Visual builder">
                                üîß Builder
                            </button>
                        </div>
                        <select id="exampleQuerySelect" class="form-select" style="max-width: 200px;">
                            <option value="">Load Example...</option>
                        </select>
                        <button id="saveQueryBtn" class="btn btn-secondary" title="Save query">
                            üíæ Save
                        </button>
                        <button id="executeQueryBtn" class="btn btn-primary" title="Execute query">
                            ‚ñ∂Ô∏è Run
                        </button>
                        <button id="clearQueryBtn" class="btn btn-secondary" title="Clear query">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>

                <!-- Code Mode (Default) -->
                <div id="codeView" class="panel-body query-section">
                    <div class="query-input-container">
                        <textarea
                            id="queryInput"
                            class="query-editor"
                            placeholder='Enter JMESPath query...

Examples:
@ - Get all data
[*].name - Get all names
[?age > `25`] - Filter by age
length(@) - Count items

Try selecting an example from the dropdown above!'
                            spellcheck="false"
                        ></textarea>
                    </div>

                    <div id="queryError" class="error-message hidden"></div>

                    <div class="query-info">
                        <span class="info-link">
                            üìñ <a href="https://jmespath.org/tutorial.html" target="_blank" rel="noopener">JMESPath Tutorial</a>
                        </span>
                    </div>
                </div>

                <!-- Builder Mode (Visual) -->
                <div id="builderView" class="panel-body query-section hidden">
                    <div class="builder-container">
                        <!-- Operation Selector -->
                        <div class="builder-section">
                            <label class="builder-label">Operation</label>
                            <select id="builderOperation" class="form-select">
                                <option value="select">Select Fields</option>
                                <option value="filter">Filter Data</option>
                                <option value="count">Count Items</option>
                                <option value="sort">Sort Data</option>
                                <option value="complex">Complex Query</option>
                            </select>
                        </div>

                        <!-- Fields Section (for Select) -->
                        <div id="fieldsSection" class="builder-section">
                            <label class="builder-label">Fields to Select</label>
                            <div id="fieldsContainer" class="fields-container"></div>
                            <button id="addFieldBtn" class="btn btn-secondary btn-sm">
                                ‚ûï Add Field
                            </button>
                        </div>

                        <!-- Filters Section (for Filter & Count) -->
                        <div id="filtersSection" class="builder-section hidden">
                            <label class="builder-label">Filter Conditions</label>
                            <div id="filtersContainer" class="filters-container"></div>
                            <button id="addFilterBtn" class="btn btn-secondary btn-sm">
                                ‚ûï Add Filter
                            </button>
                        </div>

                        <!-- Sort Section (for Sort) -->
                        <div id="sortSection" class="builder-section hidden">
                            <label class="builder-label">Sort By</label>
                            <div class="sort-controls">
                                <select id="sortField" class="form-select">
                                    <option value="">Select field...</option>
                                </select>
                                <select id="sortDirection" class="form-select">
                                    <option value="asc">Ascending</option>
                                    <option value="desc">Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Query Preview -->
                        <div class="builder-section query-preview-section">
                            <label class="builder-label">Generated Query</label>
                            <div class="query-preview-container">
                                <code id="queryPreview" class="query-preview">@</code>
                            </div>
                            <button id="buildQueryBtn" class="btn btn-primary btn-sm">
                                ‚ú® Apply Query
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="panel-header">
                    <h2>Query Results</h2>
                    <div class="panel-actions">
                        <button id="exportJSONBtn" class="btn btn-secondary" title="Export to JSON" disabled>
                            üíæ Export JSON
                        </button>
                        <button id="exportCSVBtn" class="btn btn-secondary" title="Export to CSV" disabled>
                            üìä Export CSV
                        </button>
                        <button id="copyResultsBtn" class="btn btn-secondary" title="Copy results" disabled>
                            üìã Copy
                        </button>
                    </div>
                </div>

                <div class="panel-body">
                    <div id="resultsContainer" class="output-container">
                        <div class="placeholder-message">
                            <p>üí° Enter a JMESPath query above to see results</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>
                JSON Analyser v0.4 | Week 4: Export & Polish |
                <span id="projectStatus">Full-featured JSON query tool!</span>
            </p>
        </footer>
    </div>

    <!-- Modals -->

    <!-- Save Query Modal -->
    <div id="saveQueryModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Save Query</h3>
                <button class="modal-close" data-modal="saveQueryModal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Query Name *</label>
                    <input type="text" id="queryName" class="form-input" placeholder="Enter query name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description (optional)</label>
                    <textarea id="queryDescription" class="form-input" rows="3" placeholder="Enter description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Query</label>
                    <code id="queryToSave" class="code-block"></code>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="saveQueryModal">Cancel</button>
                <button id="confirmSaveQuery" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Saved Queries Modal -->
    <div id="savedQueriesModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Saved Queries</h3>
                <button class="modal-close" data-modal="savedQueriesModal">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="savedQueriesList" class="saved-queries-list">
                    <p class="info-text">No saved queries yet</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="savedQueriesModal">Close</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Query History</h3>
                <button class="modal-close" data-modal="historyModal">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="historyList" class="history-list">
                    <p class="info-text">No query history yet</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="clearHistoryBtn" class="btn btn-error">Clear History</button>
                <button class="btn btn-secondary" data-modal="historyModal">Close</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Help & Documentation</h3>
                <button class="modal-close" data-modal="helpModal">‚úï</button>
            </div>
            <div class="modal-body help-content">
                <section class="help-section">
                    <h4>Getting Started</h4>
                    <p>JSON Analyser lets you query and analyze JSON data directly in your browser.</p>
                    <ol>
                        <li>Paste or upload JSON data on the left panel</li>
                        <li>Write queries using JMESPath or use the visual builder</li>
                        <li>View results in JSON or Table format</li>
                        <li>Export results to JSON or CSV</li>
                    </ol>
                </section>

                <section class="help-section">
                    <h4>Query Modes</h4>
                    <p><strong>üíª Code Mode:</strong> Write JMESPath queries directly</p>
                    <p><strong>üîß Builder Mode:</strong> Build queries visually without code</p>
                </section>

                <section class="help-section">
                    <h4>Example Queries</h4>
                    <ul>
                        <li><code>@</code> - Get all data</li>
                        <li><code>[*].name</code> - Get all names from array</li>
                        <li><code>[?age > `25`]</code> - Filter where age > 25</li>
                        <li><code>length(@)</code> - Count items</li>
                        <li><code>sort_by(@, &age)</code> - Sort by age</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h4>Keyboard Shortcuts</h4>
                    <ul>
                        <li><kbd>Ctrl/Cmd + Enter</kbd> - Format JSON (in JSON input)</li>
                        <li><kbd>Shift + Enter</kbd> - Execute query (in query input)</li>
                        <li><kbd>Ctrl/Cmd + K</kbd> - Clear input</li>
                        <li><kbd>Ctrl/Cmd + /</kbd> - Toggle theme</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h4>Features</h4>
                    <ul>
                        <li>‚úÖ Save and load queries</li>
                        <li>‚úÖ Query history</li>
                        <li>‚úÖ Export to JSON/CSV</li>
                        <li>‚úÖ Visual query builder</li>
                        <li>‚úÖ Dark/light themes</li>
                        <li>‚úÖ Sample datasets included</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h4>Sample Datasets</h4>
                    <p>Load example data from <code>/examples/</code>:</p>
                    <ul>
                        <li><code>users.json</code> - User data with profiles</li>
                        <li><code>products.json</code> - Product catalog</li>
                        <li><code>orders.json</code> - Order history</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h4>Learn More</h4>
                    <p>Visit <a href="https://jmespath.org" target="_blank">jmespath.org</a> for full JMESPath documentation</p>
                </section>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="helpModal">Close</button>
            </div>
        </div>
    </div>

    <!-- Browser Polyfills (must load first) -->
    <script src="js/polyfills.js"></script>

    <!-- JMESPath Library -->
    <script src="https://cdn.jsdelivr.net/npm/jmespath@0.16.0/jmespath.min.js"></script>

    <!-- JavaScript Modules -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
